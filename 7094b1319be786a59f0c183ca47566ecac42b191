{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "cf112986_987d23ad",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-04T17:24:32Z",
      "side": 1,
      "message": "one quick comment, it would be good to add as much context as possible based on your references to the commit log.",
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "80cde52d_ef23c0da",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-04T17:47:56Z",
      "side": 1,
      "message": "Do you mean in the body of the commit message? I can do that, but I didn\u0027t see any other commits with text in the body inside this repo, so I though there was some guideline about that (or an error from my side, since I\u0027m not much used to Gerrit)",
      "parentUuid": "cf112986_987d23ad",
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3a70fea_89e2a4b6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-04T17:49:25Z",
      "side": 1,
      "message": "yes in the body of the commit messages.\nfor things which are subtle like this, its a good idea.",
      "parentUuid": "80cde52d_ef23c0da",
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79c533e8_a1874774",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 6186
      },
      "writtenOn": "2022-08-04T18:39:14Z",
      "side": 1,
      "message": "Thanks for looking into this. The factor of 2 comes from the original implementation of HomogenousVectorParameterization. As you have already discovered, this was based on Hartley \u0026 Zisserman, in which the formulas are written with a factor of 2. As sphere manifold and line manifold are closely related I kept the factor of 2. When implementing the new manifold class we were discussing whether it makes sense to do that but decided against it back then (see https://ceres-solver-review.googlesource.com/c/ceres-solver/+/19860 patchset3). Btw it is the same for quaternions (factor of 2).\n\nI am in favour of removing that factor 2.",
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "260e4486_eae327bb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-05T10:20:43Z",
      "side": 1,
      "message": "Perfect then. Since I also updated all the numerical tests, now it should be a good time to update this before the full transition to manifolds.",
      "parentUuid": "79c533e8_a1874774",
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0eeab728_32627638",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-05T10:21:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "b3a70fea_89e2a4b6",
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eca600eb_cf11083e",
        "filename": "include/ceres/internal/sphere_manifold_functions.h",
        "patchSetId": 1
      },
      "lineNbr": 68,
      "author": {
        "id": 6186
      },
      "writtenOn": "2022-08-04T18:39:14Z",
      "side": 1,
      "message": "There are different styles but I think in ceres usually there is no const value used in function parameters, but I am not 100% sure.",
      "range": {
        "startLine": 68,
        "startChar": 38,
        "endLine": 68,
        "endChar": 43
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f381e7b9_78834907",
        "filename": "include/ceres/internal/sphere_manifold_functions.h",
        "patchSetId": 1
      },
      "lineNbr": 68,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-05T00:17:57Z",
      "side": 1,
      "message": "since we have the implementation right here, its good to have const here.",
      "parentUuid": "eca600eb_cf11083e",
      "range": {
        "startLine": 68,
        "startChar": 38,
        "endLine": 68,
        "endChar": 43
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ddc26bb_842f2baf",
        "filename": "include/ceres/line_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 159,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-04T17:27:57Z",
      "side": 1,
      "message": "I think we have a similar ambiguity in our quaternion implementation, is it worth fixing that too?",
      "range": {
        "startLine": 159,
        "startChar": 22,
        "endLine": 159,
        "endChar": 26
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5c8fd09_419b948b",
        "filename": "include/ceres/line_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 159,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-04T17:43:25Z",
      "side": 1,
      "message": "I would need to check the rest of the sota against that. For line and sphere manifolds it is very intuitive, but maybe for quaternions there is some controversy.",
      "parentUuid": "3ddc26bb_842f2baf",
      "range": {
        "startLine": 159,
        "startChar": 22,
        "endLine": 159,
        "endChar": 26
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b07788d_e7e9926f",
        "filename": "include/ceres/line_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 159,
      "author": {
        "id": 6186
      },
      "writtenOn": "2022-08-04T18:39:14Z",
      "side": 1,
      "message": "The formulars for quaternions are (almost) the same as for sphere parameterization. I am not sure but maybe quaternion parameterization could be just and alias for sphere parameterization.",
      "parentUuid": "b5c8fd09_419b948b",
      "range": {
        "startLine": 159,
        "startChar": 22,
        "endLine": 159,
        "endChar": 26
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f3520032_c3dce072",
        "filename": "include/ceres/line_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 159,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-05T00:17:57Z",
      "side": 1,
      "message": "I suppose so, we try and make the quaternion impl as fast as possible though since it is very extensively used and the size is known and fixed forever.",
      "parentUuid": "1b07788d_e7e9926f",
      "range": {
        "startLine": 159,
        "startChar": 22,
        "endLine": 159,
        "endChar": 26
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "987462c3_5d5d11e7",
        "filename": "include/ceres/line_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 159,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-05T10:20:43Z",
      "side": 1,
      "message": "Yes, it is a good idea to have a different implementation for quaternions since they are a Lie group (not only a manifold) with a special, faster implementation than simply using the 4-dimensional sphere (even though results should hold). Also I was checking the current quaternion implementation and did not see any *2 or *0.5 at a first glance. Is it really following Hartley \u0026 Zisserman? Maybe it was changed at some point.",
      "parentUuid": "f3520032_c3dce072",
      "range": {
        "startLine": 159,
        "startChar": 22,
        "endLine": 159,
        "endChar": 26
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3dcccd7_6b2467a2",
        "filename": "include/ceres/line_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 159,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-05T12:43:36Z",
      "side": 1,
      "message": "https://github.com/ceres-solver/ceres-solver/issues/311",
      "parentUuid": "987462c3_5d5d11e7",
      "range": {
        "startLine": 159,
        "startChar": 22,
        "endLine": 159,
        "endChar": 26
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c35a0489_99309e9f",
        "filename": "include/ceres/line_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 159,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-08T15:51:51Z",
      "side": 1,
      "message": "I see. In the quaternion case it even seems more beneficial to use that notation since you get rid of some divisions (however I personally would prefer the covariance to represent angles and not half-angles). Should we go on with this PR and have a different convention for quaternions and spheres/lines then? I guess that is the question now. I could also update the quaternions and all their tests in another PR if eventually that is decided.",
      "parentUuid": "b3dcccd7_6b2467a2",
      "range": {
        "startLine": 159,
        "startChar": 22,
        "endLine": 159,
        "endChar": 26
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "862d5272_9c2dd01c",
        "filename": "include/ceres/sphere_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 117,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-04T17:27:57Z",
      "side": 1,
      "message": "perhaps send this change out on its own since it does not affect numerics, and can just be checked in.\nits okay if thats too much trouble and you want to just keep it in this CL.",
      "range": {
        "startLine": 117,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d84be0dd_7db45a9d",
        "filename": "include/ceres/sphere_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 117,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-04T17:43:25Z",
      "side": 1,
      "message": "Sure, I can send it in a different PR. It should be merge before this CL then, because if not the tests will fail (I added some that cover this case)",
      "parentUuid": "862d5272_9c2dd01c",
      "range": {
        "startLine": 117,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d14745e9_cf109f75",
        "filename": "include/ceres/sphere_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 117,
      "author": {
        "id": 6186
      },
      "writtenOn": "2022-08-04T18:39:14Z",
      "side": 1,
      "message": "Thanks for fixing this. I was not aware of this limitation in Eigen.",
      "parentUuid": "d84be0dd_7db45a9d",
      "range": {
        "startLine": 117,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9a1d4f6_c59d0c6b",
        "filename": "include/ceres/sphere_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 117,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-05T00:17:57Z",
      "side": 1,
      "message": "yes sending it and merging it before this CL is a good idea.",
      "parentUuid": "d14745e9_cf109f75",
      "range": {
        "startLine": 117,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b6f98bb8_6d4b991a",
        "filename": "include/ceres/sphere_manifold.h",
        "patchSetId": 1
      },
      "lineNbr": 117,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-05T10:20:43Z",
      "side": 1,
      "message": "Already sent the PR. Will erase this in the next patchset",
      "parentUuid": "c9a1d4f6_c59d0c6b",
      "range": {
        "startLine": 117,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "15c96b4a_ea12172c",
        "filename": "internal/ceres/manifold_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 707,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-04T17:27:57Z",
      "side": 1,
      "message": "why do we need to normalize here?",
      "range": {
        "startLine": 707,
        "startChar": 4,
        "endLine": 707,
        "endChar": 13
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "276a0f08_d6cecc97",
        "filename": "internal/ceres/manifold_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 707,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-04T17:43:25Z",
      "side": 1,
      "message": "Because all the math is meant for unit vectors (points in the unit n-dimensional sphere). Thus the ambient space points should always be normalized. There is some additional math to work with non-unit, constant-norm vectors, but I think its not worth it to add it and over-complicate things (you can always multiply the unit vector by some magnitude outside the manifold). \n\nBecause of that, if we input a non-unit vector that is outside of the manifold then the test would make no sense, and the results would not be conclusive.",
      "parentUuid": "15c96b4a_ea12172c",
      "range": {
        "startLine": 707,
        "startChar": 4,
        "endLine": 707,
        "endChar": 13
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1108314a_a36ab64d",
        "filename": "internal/ceres/manifold_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 707,
      "author": {
        "id": 6186
      },
      "writtenOn": "2022-08-04T18:39:14Z",
      "side": 1,
      "message": "Are you sure the formulars are only for |x|\u003d1? The original implementation (HomogenousLineParameterization which was based on Hartley \u0026 Zisserman) did not have that limitation. And if the current implementation does not work with |x|!\u003d1 (for sphere and for line parameterization) it is probably a bug I introduced. Is that test failing if no normalization would be done?",
      "parentUuid": "276a0f08_d6cecc97",
      "range": {
        "startLine": 707,
        "startChar": 4,
        "endLine": 707,
        "endChar": 13
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0d41d85f_dc951049",
        "filename": "internal/ceres/manifold_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 707,
      "author": {
        "id": 5002
      },
      "writtenOn": "2022-08-05T00:17:57Z",
      "side": 1,
      "message": "Yes we are supposed to preserve the norm of the vector not make it unit norm. Thats why is the SphereManifold not the UnitSphereManifold.",
      "parentUuid": "1108314a_a36ab64d",
      "range": {
        "startLine": 707,
        "startChar": 4,
        "endLine": 707,
        "endChar": 13
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f17eb8b_244e436f",
        "filename": "internal/ceres/manifold_test.cc",
        "patchSetId": 1
      },
      "lineNbr": 707,
      "author": {
        "id": 6677
      },
      "writtenOn": "2022-08-05T10:20:43Z",
      "side": 1,
      "message": "Ok I took a deeper look into this and saw the real problem. \n - It is true that the norm is preserved in the current implementation (I was supposing not since all the references were for unit spheres). The only thing to take into account is that if |x|!\u003d1, magnitudes in the tangent space will not represent the traveled geodesic distance but only the traveled angle (and one will need to multiply by the radius to get the geodesic distance). However I don\u0027t see a problem with this (it is more intuitive that the magnitudes are simply angles), so we can leave it as is.\n - The real cause that makes the test fail in the new implementation is more subtle. Now in \"ComputeSphereManifoldMinus\" we better cover the special case when \"hy_norm \u003d\u003d 0\". This case is basically a step function that is 0 when \"y_last \u003e\u003d0\" and pi otherwise (I will update from the current atan2 fix to using a ternary operator in the next patchset). The problem comes when numerically computing the MinusJacobian at x\u003d{0.001, 0.0, 0.0, 0.0}. Since the magnitude of x is small, it is easy to fall in a case where \"y_last\" switches from 0 to pi, thus giving a wrong numeric jacobian because of that discontinuity. Simply reducing the \"options.ridders_relative_initial_step_size\" to 1e-6 for the numeric differentiation or using a value of 0.01 for x will make the test run OK again.",
      "parentUuid": "0d41d85f_dc951049",
      "range": {
        "startLine": 707,
        "startChar": 4,
        "endLine": 707,
        "endChar": 13
      },
      "revId": "7094b1319be786a59f0c183ca47566ecac42b191",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    }
  ]
}