{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "587bfa56_2776770f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 6472
      },
      "writtenOn": "2021-02-13T02:37:34Z",
      "side": 1,
      "message": "Hi Alex,\n\nI\u0027m adding you as reviewer as Ceres\u0027s build system seems to have your fingerprints all over it.  This little patch allows to use CMAKE_UNITY_BUILD with ceres, which speeds up the build significantly (O(10%)).  (IF you\u0027re not familiar with the term: \"unity build\" means that instead of compiling the source files separately they are grouped together and then compiled in batches by having an automatically generated source file which #includes the individual files in each group and compiling that file instead.  The advantage especially for template-heavy code should be clear.  The standard pattern to enable it is to run cmake with the \u0027-DCMAKE_UNITY_BUILD\u003dON\u0027 flag.)\n\nThe patch does two things, one is the trivial  part in solver_utils.h which was missing an include guard.  The other part is dealing with the fact that the schur implementation uses some custom settings for Eigen, and these are handled via a macro.  Since this is order-dependent, the safe way is to disable the unity build for these files.  This is no loss, because in a previous patch I already took care of speeding up the build of the schur specializations, effectively gaining the effect of a unity build.  There\u0027s one catch though: the unity build can only be disabled on a per-file basis with cmake \u003e\u003d 3.16.  ceres requires cmake \u003e\u003d 3.5.0.  I was tempted to push the required version, but since 3.16 is still fairly recent (released in Nov 2019) I went another route, only allowing the unity build with this newer version.  It\u0027s opt-in anyway, so in this way the change is invisible to users who don\u0027t care about unity builds.\n\nOne fun observation: with the unity build, libceres.a shrinks from 7.5 MB to 7 MB on my system.  This is of course not an indication of more compact or better code, but an expression of the fact that an .a file simply assembles copies of all the .o files -- and each one contains instantiations of all the repeated templates.  Nevertheless, it is indicative of the amount of repeated compilations that were saved, the amount of which seems to line up nicely with the time savings.\n\nCheers,\n- Tobi",
      "revId": "161f4b7a43797126d8f4c9610e8a0ae4a9915e76",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    }
  ]
}