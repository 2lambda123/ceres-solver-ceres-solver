{
  "comments": [
    {
      "key": {
        "uuid": "c6ca9cad_0785b7f3",
        "filename": "CMakeLists.txt",
        "patchSetId": 3
      },
      "lineNbr": 182,
      "author": {
        "id": 5155
      },
      "writtenOn": "2020-02-23T14:23:58Z",
      "side": 1,
      "message": "I don\u0027t think you need this `AND NOT CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS`, as it\u0027s a binary variable so you wouldn\u0027t be doing any harm by (re)enabling it if it is already enabled and this wouldn\u0027t respect the case when it was explicitly disabled by the user, e.g. via -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS\u003dFALSE, in that case this would just re-enable it anyway - is that what you would expect to happen?\n\nAn alternative here might be to expose this as an option similar to BUILD_SHARED_LIBS s/t the user can control it directly.",
      "revId": "ca9fae775ed9e737073698cc72194dc51a6ba951",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2e1aae3d_e6260079",
        "filename": "CMakeLists.txt",
        "patchSetId": 3
      },
      "lineNbr": 182,
      "author": {
        "id": 5150
      },
      "writtenOn": "2020-02-26T17:14:18Z",
      "side": 1,
      "message": "\u003e this wouldn\u0027t respect the case when it was explicitly disabled by the user, e.g. via -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS\u003dFALSE, in that case this would just re-enable it anyway - is that what you would expect to happen?\n\nI\u0027ve seen different approaches to this problem. The advantage with this approach is that a BUILD_TESTING\u003dON build will always Just Work while still leaving the sensible default of CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS\u003dOFF in place if the user were to later turn off BUILD_TESTING.\n\nI\u0027m not sure why the user would pass -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS\u003dFALSE since CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS is off by default.\n\nI\u0027m fine either way though. Consistency with the way Ceres normally handles this is probably the most important factor here.",
      "parentUuid": "c6ca9cad_0785b7f3",
      "revId": "ca9fae775ed9e737073698cc72194dc51a6ba951",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd5d7aa4_97d112bf",
        "filename": "CMakeLists.txt",
        "patchSetId": 3
      },
      "lineNbr": 182,
      "author": {
        "id": 5155
      },
      "writtenOn": "2020-02-26T19:45:47Z",
      "side": 1,
      "message": "I\u0027m still confused about this as for these two cases:\n\nBUILD_TESTING \u003d ON\nBUILD_SHARED_LIBS \u003d ON\nCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS \u003d OFF (or not defined)\n\n-\u003e Sets CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS \u003d ON\n\nBUILD_TESTING \u003d ON\nBUILD_SHARED_LIBS \u003d ON\nCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS \u003d ON\n\n-\u003e No change\n\nthe post conditions with BUILD_TESTING \u0026\u0026 BUILD_SHARED_LIBS are the same.  So when you say: \"BUILD_TESTING\u003dON build will always Just Work while still leaving the sensible default of CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS\u003dOFF\" that doesn\u0027t seem to be what is happening here, or are you relying on the state of BUILD_SHARED_LIBS being what controls this?",
      "parentUuid": "2e1aae3d_e6260079",
      "revId": "ca9fae775ed9e737073698cc72194dc51a6ba951",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9ee9496b_96f23c31",
        "filename": "CMakeLists.txt",
        "patchSetId": 3
      },
      "lineNbr": 182,
      "author": {
        "id": 5150
      },
      "writtenOn": "2020-02-27T21:50:26Z",
      "side": 1,
      "message": "I think maybe the confusion here is that the *non-cached* version of CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS is what gets changed to ON when necessary (when BUILD_TESTING and BUILD_SHARED_LIBS are both enabled) so if CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS has been set as a *cached* variable by the user then that ON/OFF value will be retained, but will be ignored after the `set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)` line is evaluated.",
      "parentUuid": "dd5d7aa4_97d112bf",
      "revId": "ca9fae775ed9e737073698cc72194dc51a6ba951",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac324716_3058aa19",
        "filename": "CMakeLists.txt",
        "patchSetId": 3
      },
      "lineNbr": 182,
      "author": {
        "id": 5155
      },
      "writtenOn": "2020-02-28T09:45:34Z",
      "side": 1,
      "message": "Right I can see the source of the confusion, that\u0027s not how CACHE vs local variables work [1] - local variables override CACHE variables if they have the same name, but they are not persisted.  However, if you set a CACHE variable then CMake also removes any pre-existing local variable with the same name in the current scope.  As a result, I don\u0027t think this is doing what you think it is.\n\n[1]: https://cmake.org/cmake/help/v3.0/command/set.html",
      "parentUuid": "9ee9496b_96f23c31",
      "revId": "ca9fae775ed9e737073698cc72194dc51a6ba951",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f5eb3aab_bdf79429",
        "filename": "CMakeLists.txt",
        "patchSetId": 3
      },
      "lineNbr": 182,
      "author": {
        "id": 5150
      },
      "writtenOn": "2020-02-28T19:00:46Z",
      "side": 1,
      "message": "This is the test I did:\n\n1. Add the following after the if(MSVC) block:\n\n   message(STATUS \"CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS: ${CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS}\")\n\n2. Run the following from a Git Bash shell in a `vcvarsall.bat x64` environment. \n\n$ cmake ~/git/ceres-solver -LAH -GNinja \\\n  -DBUILD_TESTING:BOOL\u003dON \\\n  -DBUILD_SHARED_LIBS:BOOL\u003dON \\\n  -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:BOOL\u003dOFF \\\n  |\u0026 egrep \u0027CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS|Build files have been written\u0027\n-- Turning on CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS to support building tests with MSVC.\n-- CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS: ON\n-- Build files have been written to: C:/Users/tbraunjones/git/ceres-solver-build\nCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:BOOL\u003dOFF\n\nThe `-LAH` cmake option is used to print out the state of cache variables after configuring completes. We can see that CMake sees the CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS variable as being ON even though the cached version of that variable is OFF.\n\nHere is some further testing which I think is all correct behavior. Does this look like what you would expect as well?\n\n$ rm -rf *\n\n$ cmake ~/git/ceres-solver -LAH -GNinja \\\n  -DBUILD_TESTING:BOOL\u003dON \\\n  -DBUILD_SHARED_LIBS:BOOL\u003dON \\\n  |\u0026 egrep \u0027CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS|Build files have been written\u0027\n-- Turning on CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS to support building tests with MSVC.\n-- CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS: ON\n-- Build files have been written to: C:/Users/tbraunjones/git/ceres-solver-build\n\n$ cmake ~/git/ceres-solver -LAH -GNinja \\\n  -DBUILD_TESTING:BOOL\u003dOFF \\\n  |\u0026 egrep \u0027CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS|Build files have been written\u0027\n-- CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:\n-- Build files have been written to: C:/Users/tbraunjones/git/ceres-solver-build\n\n$ cmake ~/git/ceres-solver -LAH -GNinja \\\n  -DBUILD_TESTING:BOOL\u003dOFF \\\n  -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:BOOL\u003dON \\\n  |\u0026 egrep \u0027CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS|Build files have been written\u0027\n-- CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS: ON\n-- Build files have been written to: C:/Users/tbraunjones/git/ceres-solver-build\nCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:BOOL\u003dON\n\n$ cmake ~/git/ceres-solver -LAH -GNinja \\\n  -DBUILD_TESTING:BOOL\u003dON \\\n  -DCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:BOOL\u003dON \\\n  |\u0026 egrep \u0027CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS|Build files have been written\u0027\n-- CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS: ON\n-- Build files have been written to: C:/Users/tbraunjones/git/ceres-solver-build\nCMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:BOOL\u003dON\n\n$ rm -rf *\n\n$ cmake ~/git/ceres-solver -LAH -GNinja \\\n  -DBUILD_TESTING:BOOL\u003dOFF \\\n  -DBUILD_SHARED_LIBS:BOOL\u003dON \\\n  |\u0026 egrep \u0027CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS|Build files have been written\u0027\n-- CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS:\n-- Build files have been written to: C:/Users/tbraunjones/git/ceres-solver-build",
      "parentUuid": "ac324716_3058aa19",
      "revId": "ca9fae775ed9e737073698cc72194dc51a6ba951",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329",
      "unresolved": true
    }
  ]
}