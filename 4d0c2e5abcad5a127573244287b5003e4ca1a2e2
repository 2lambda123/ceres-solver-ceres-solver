{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5ca5a128_08670333",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 5002
      },
      "writtenOn": "2024-05-16T23:52:05Z",
      "side": 1,
      "message": "We are getting close Mark.",
      "revId": "4d0c2e5abcad5a127573244287b5003e4ca1a2e2",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c261fb4_d52515cc",
        "filename": "internal/ceres/generate_bundle_adjustment_tests.py",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 5002
      },
      "writtenOn": "2024-05-16T23:52:05Z",
      "side": 1,
      "message": "I think with cholesky on GPU you have also enabled the ability to do visibility based preconditioning on the GPU.  Can you try ITERATIVE_SCHUR + CLUSTER_JACOBI using bundle_adjuster? I am pretty sure it will work. It may not work well (because of the per iteration back and forth with the GPU) but I think it will work.\n\nIf that is the case, then we need to make two more changes.\n\n1. update \n\n\nITERATIVE_SOLVER_CONFIGS \u003d [\n    # Linear solver            Sparse backend      Preconditioner\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027NO_SPARSE\u0027,        \u0027JACOBI\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027NO_SPARSE\u0027,        \u0027SCHUR_JACOBI\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027NO_SPARSE\u0027,        \u0027SCHUR_POWER_SERIES_EXPANSION\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027SUITE_SPARSE\u0027,     \u0027CLUSTER_JACOBI\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027EIGEN_SPARSE\u0027,     \u0027CLUSTER_JACOBI\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027ACCELERATE_SPARSE\u0027,\u0027CLUSTER_JACOBI\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027SUITE_SPARSE\u0027,     \u0027CLUSTER_TRIDIAGONAL\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027EIGEN_SPARSE\u0027,     \u0027CLUSTER_TRIDIAGONAL\u0027),\n    (\u0027ITERATIVE_SCHUR\u0027,        \u0027ACCELERATE_SPARSE\u0027,\u0027CLUSTER_TRIDIAGONAL\u0027),\n]\n\nto include CUDA_SPARSE\n\nand this nested if will also need to check for iterative_schur + either of these two preconditioners.",
      "range": {
        "startLine": 226,
        "startChar": 25,
        "endLine": 226,
        "endChar": 37
      },
      "revId": "4d0c2e5abcad5a127573244287b5003e4ca1a2e2",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0e296444_b73ae23a",
        "filename": "internal/ceres/generate_bundle_adjustment_tests.py",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 6667
      },
      "writtenOn": "2024-05-17T19:17:53Z",
      "side": 1,
      "message": "While it is indeed working via bundle_adjuster (no errors and final cost is close to the suite_sparse variant), it seems to be not stable (based on differences in \"cost_change\") and following tests are failing:\n        125 - ba_iterschur_cudasparse_clusttri_auto_test (Failed)\n        147 - ba_iterschur_cudasparse_clusttri_auto_threads_test (Failed)\n        169 - ba_iterschur_cudasparse_clusttri_user_test (Failed)\n        191 - ba_iterschur_cudasparse_clusttri_user_threads_test (Failed)\n\nStill, i pushed the change and i will try to find some time for digging into that tomorrow.",
      "parentUuid": "6c261fb4_d52515cc",
      "range": {
        "startLine": 226,
        "startChar": 25,
        "endLine": 226,
        "endChar": 37
      },
      "revId": "4d0c2e5abcad5a127573244287b5003e4ca1a2e2",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89654b4a_0de69292",
        "filename": "internal/ceres/generate_bundle_adjustment_tests.py",
        "patchSetId": 7
      },
      "lineNbr": 226,
      "author": {
        "id": 5002
      },
      "writtenOn": "2024-05-17T20:41:50Z",
      "side": 1,
      "message": "Thanks, this is interesting. If you can share logs of your experiments maybe I can help debug this too (I do not have a cuda machine setup to do these experiments, but I suppose I should find a vm with cuda hardware).",
      "parentUuid": "0e296444_b73ae23a",
      "range": {
        "startLine": 226,
        "startChar": 25,
        "endLine": 226,
        "endChar": 37
      },
      "revId": "4d0c2e5abcad5a127573244287b5003e4ca1a2e2",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ac8fc8ed_e4091b28",
        "filename": "internal/ceres/generated_bundle_adjustment_tests/ba_sparsecholesky_cudasparse_auto_test.cc",
        "patchSetId": 7
      },
      "lineNbr": 43,
      "author": {
        "id": 5002
      },
      "writtenOn": "2024-05-16T23:52:05Z",
      "side": 1,
      "message": "at the risk of creating work for you, but in the interest of consistency these two macros should have the same polarity. \n\nIf we stick with CERES_NO_CUDA then CERES_NO_CUDSS is what we should do no?",
      "range": {
        "startLine": 43,
        "startChar": 7,
        "endLine": 43,
        "endChar": 22
      },
      "fixSuggestions": [
        {
          "fixId": "388f325d_7496fe06",
          "description": "prompt_to_edit API",
          "replacements": [
            {
              "path": "internal/ceres/generated_bundle_adjustment_tests/ba_sparsecholesky_cudasparse_auto_test.cc",
              "range": {
                "startLine": 43,
                "startChar": 0,
                "endLine": 44,
                "endChar": 0
              },
              "replacement": "#ifndef CERES_USE_CUDSS\n"
            }
          ]
        }
      ],
      "revId": "4d0c2e5abcad5a127573244287b5003e4ca1a2e2",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6c8eed3c_3a371d65",
        "filename": "internal/ceres/generated_bundle_adjustment_tests/ba_sparsecholesky_cudasparse_auto_test.cc",
        "patchSetId": 7
      },
      "lineNbr": 43,
      "author": {
        "id": 6667
      },
      "writtenOn": "2024-05-17T19:17:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ac8fc8ed_e4091b28",
      "range": {
        "startLine": 43,
        "startChar": 7,
        "endLine": 43,
        "endChar": 22
      },
      "revId": "4d0c2e5abcad5a127573244287b5003e4ca1a2e2",
      "serverId": "cdcfcfbe-2044-3b1f-b5d4-da77ad542329"
    }
  ]
}